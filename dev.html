<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>GO HOME</title>
<link rel="icon" href="https://raw.githubusercontent.com/lapgia57-netizen/gohome/main/favicon.ico">
<style>
:root{
  --bg:#0d1117;
  --panel:#161b22;
  --border:#30363d;
  --red:#f85149;
  --green:#238636;
  --text:#c9d1d9;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui;
  background:var(--bg);
  color:var(--text);
}

/* ===== LOADING ===== */
#loading{
  position:fixed;
  inset:0;
  background:rgba(13,17,23,.96);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  z-index:9999;
}
.loader{
  width:55px;
  height:55px;
  border:4px solid var(--border);
  border-top:4px solid var(--red);
  border-radius:50%;
  animation:spin 1s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}
#loading p{
  margin-top:15px;
  color:#8b949e;
  font-size:14px;
}

/* ===== HEADER ===== */
.header{
  background:#010409;
  padding:18px;
  text-align:center;
  border-bottom:3px solid var(--red);
}
.header h1{
  margin:0;
  color:var(--red);
}
.header small{
  color:#8b949e;
}

/* ===== LAYOUT ===== */
.container{
  display:flex;
  height:calc(100vh - 96px);
}
.sidebar{
  width:35%;
  background:var(--panel);
  border-right:1px solid var(--border);
  overflow:auto;
}
.content{
  width:65%;
  padding:20px;
  overflow:auto;
}

/* ===== TREE ===== */
.search{
  width:100%;
  padding:12px;
  background:var(--bg);
  border:1px solid var(--border);
  color:white;
}
.tree ul{
  list-style:none;
  padding-left:18px;
}
.tree li{
  padding:6px;
  border-radius:6px;
  cursor:pointer;
}
.tree li:hover{background:#30363d}
.folder::before{content:"üìÅ "}
.file::before{content:"üìÑ "}

/* ===== CONTENT ===== */
#file-content{
  background:var(--bg);
  padding:20px;
  border-radius:10px;
  border:1px solid var(--border);
}
.instructions{
  background:#21262d;
  padding:15px;
  border-radius:8px;
  margin:15px 0;
}

/* ===== FLOAT INFO ===== */
.online-count{
  position:fixed;
  bottom:12px;
  right:12px;
  background:var(--green);
  color:white;
  padding:10px 16px;
  border-radius:50px;
  font-weight:bold;
}
.clock{
  position:fixed;
  bottom:12px;
  left:12px;
  background:#21262d;
  padding:10px 16px;
  border-radius:50px;
  border:1px solid var(--border);
  font-size:13px;
}
.refresh{
  text-align:center;
  font-size:12px;
  color:#8b949e;
  margin:6px 0;
}
</style>
</head>
<body>

<!-- LOADING -->
<div id="loading">
  <div class="loader"></div>
  <p>GO HOME ƒëang m·ªü c·ª≠a qu√°n net...</p>
</div>

<div class="header">
  <h1>GO HOME</h1>
  <small>
    Online <span id="online">0</span> anh em ‚Ä¢ Auto c·∫≠p nh·∫≠t 2 ph√∫t
  </small>
</div>

<div class="container">
  <div class="sidebar">
    <input class="search" id="search" placeholder="T√¨m file, nick, tin nh·∫Øn...">
    <div class="tree" id="tree">ƒêang load repo...</div>
  </div>

  <div class="content">
    <div id="file-content">
      <h2>üñ•Ô∏è Explorer Control Panel</h2>
      <div class="instructions">
        <b>‚ú® UI/UX m·ªõi:</b><br>
        ‚Ä¢ HTML ‚Üí m·ªü tr·ª±c ti·∫øp tr√™n <code>back.iq920.fun</code><br>
        ‚Ä¢ File kh√°c ‚Üí m·ªü raw GitHub<br><br>
        <b>M·∫πo:</b> <code>online/nick.html</code> = profile c√° nh√¢n online
      </div>
      <em>Ch·ªçn file b√™n tr√°i ƒë·ªÉ m·ªü tab m·ªõi.</em>
    </div>
  </div>
</div>

<div class="online-count">Online: <span id="online2">0</span></div>
<div class="clock" id="clock">‚è∞ --:--:--</div>
<div class="refresh">C·∫≠p nh·∫≠t: <span id="time"></span></div>

<script>
const owner="lapgia57-netizen";
const repo="gohome";
const api=`https://api.github.com/repos/${owner}/${repo}/git/trees/main?recursive=1`;
const customDomain="https://back.iq920.fun/";

async function loadRepo(){
  document.getElementById("loading").style.display="flex";
  try{
    const res=await fetch(api);
    const data=await res.json();
    const files=data.tree.filter(f=>f.type==="blob");
    const online=files.filter(f=>f.path.startsWith("online/")).length;

    onlineEl(online);
    renderTree(data.tree);
    updateTime();
  }catch(e){
    tree.innerHTML="‚ùå L·ªói GitHub API";
  }
  setTimeout(()=>loading.style.display="none",600);
}

function onlineEl(n){
  online.textContent=n;
  online2.textContent=n;
}

function renderTree(items){
  const ul=document.createElement("ul");
  const folders={};

  items.filter(i=>i.type==="blob").forEach(item=>{
    const parts=item.path.split('/');
    let current=ul;

    for(let i=0;i<parts.length-1;i++){
      const name=parts.slice(0,i+1).join('/');
      if(!folders[name]){
        const li=document.createElement("li");
        li.className="folder";
        li.textContent=parts[i]+"/";
        const sub=document.createElement("ul");
        sub.style.display="none";
        li.onclick=e=>{
          e.stopPropagation();
          sub.style.display=sub.style.display==="none"?"block":"none";
        };
        li.appendChild(sub);
        folders[name]={ul:sub};
        (i===0?ul:folders[parts.slice(0,i).join('/')].ul).appendChild(li);
      }
      current=folders[name].ul;
    }

    const file=document.createElement("li");
    file.className="file";
    file.textContent=parts.at(-1);
    file.onclick=e=>{
      e.stopPropagation();
      openFile(item.path);
    };
    current.appendChild(file);
  });

  tree.innerHTML="";
  tree.appendChild(ul);
}

function openFile(path){
  const url=path.endsWith(".html")
    ? customDomain+path
    : `https://raw.githubusercontent.com/${owner}/${repo}/main/${path}`;
  window.open(url,"_blank");
}

function updateTime(){
  time.textContent=new Date().toLocaleString("vi-VN");
}

/* ===== CLOCK VN REALTIME ===== */
setInterval(()=>{
  clock.textContent="‚è∞ "+new Date().toLocaleTimeString("vi-VN",{hour12:false});
},1000);

/* SEARCH */
search.oninput=e=>{
  const t=e.target.value.toLowerCase();
  document.querySelectorAll(".file,.folder").forEach(el=>{
    el.style.display=el.textContent.toLowerCase().includes(t)?"":"none";
  });
};

loadRepo();
setInterval(loadRepo,120000);
</script>
</body>
</html>
