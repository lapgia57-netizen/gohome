<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LCP - QuÃ¡n Net Chat Lan</title>
  <link rel="icon" href="https://raw.githubusercontent.com/lapgia57-netizen/gohome/main/favicon.ico" type="image/x-icon">
  <style>
    body { margin:0; font-family: system-ui; background:#0d1117; color:#c9d1d9; }
    .header { background:#010409; padding:20px; text-align:center; border-bottom:3px solid #f85149; }
    h1 { margin:0; color:#f85149; }
    .container { display:flex; height:calc(100vh - 100px); }
    .sidebar { width:35%; background:#161b22; border-right:1px solid #30363d; overflow:auto; }
    .content { width:65%; padding:20px; overflow:auto; }
    .tree ul { padding-left:20px; margin:5px 0; list-style:none; }
    .tree li { padding:6px; cursor:pointer; border-radius:6px; }
    .tree li:hover { background:#30363d; }
    .tree .folder::before { content:"ğŸ“ "; }
    .tree .file::before { content:"ğŸ“„ "; }
    .search { width:100%; padding:12px; background:#0d1117; border:1px solid #30363d; color:white; box-sizing:border-box; }
    #file-content { background:#0d1117; padding:20px; border-radius:8px; min-height:100%; }
    .online-count { position:fixed; bottom:10px; right:10px; background:#238636; color:white; padding:10px 15px; border-radius:50px; font-weight:bold; }
    .refresh { font-size:12px; color:#8b949e; text-align:center; margin-top:10px; }
    .instructions { background:#21262d; padding:15px; border-radius:8px; margin:10px 0; }
  </style>
</head>
<body>
  <div class="header">
    <h1>LCP â€“ Chá» táº¡i quÃ¡n net</h1>
    <p>Äang cÃ³ <span id="online">0</span> anh em trong quÃ¡n â€¢ Click file Ä‘á»ƒ má»Ÿ tab má»›i â€¢ Auto cáº­p nháº­t má»—i 2 phÃºt</p>
  </div>

  <div class="container">
    <div class="sidebar">
      <input type="text" class="search" id="search" placeholder="TÃ¬m file, nick, tin nháº¯n..."/>
      <div class="tree" id="tree">Äang load repo...</div>
    </div>
    <div class="content">
      <div id="file-content">
        <h2>ğŸ–¥ï¸ Báº£ng Ä‘iá»u khiá»ƒn Explorer</h2>
        <div class="instructions">
          <strong>Chá»©c nÄƒng má»›i:</strong><br>
          - <strong>File .html:</strong> Má»Ÿ tab má»›i táº¡i <code>https://lcp.lck.io.vn/[tÃªn-file]</code> (render trá»±c tiáº¿p trÃªn domain quÃ¡n net).<br>
          - <strong>File khÃ¡c:</strong> Má»Ÿ raw content táº¡i GitHub trong tab má»›i (xem nhanh Markdown/text).<br>
          <br>
          <strong>Máº¹o quÃ¡n net:</strong> Táº¡o file <code>online/nick-cua-ban.html</code> vá»›i ná»™i dung "Ä‘ang cÃ y rank" â†’ click nÃ³ sáº½ má»Ÿ trang cÃ¡ nhÃ¢n Ä‘áº¹p trÃªn domain!
        </div>
        <p><em>Chá»n file tá»« cÃ¢y bÃªn trÃ¡i Ä‘á»ƒ má»Ÿ tab má»›i nhÃ©!</em></p>
      </div>
    </div>
  </div>

  <div class="online-count">Online: <span id="online2">0</span></div>
  <div class="refresh">Cáº­p nháº­t láº§n cuá»‘i: <span id="time"></span></div>

  <script>
    // === THAY Äá»”I Táº I ÄÃ‚Y: repo má»›i
    const owner = "lapgia57-netizen";
    const repo = "gohome";                                      // â† ÄÃƒ Äá»”I
    const api = `https://api.github.com/repos/${owner}/${repo}/git/trees/main?recursive=1`;
    const customDomain = "https://lcp.lck.io.vn/";               // Giá»¯ nguyÃªn domain render HTML Ä‘áº¹p

    async function loadRepo() {
      try {
        const res = await fetch(api);
        const data = await res.json();
        const files = data.tree.filter(f => f.type === "blob");
        const onlineCount = files.filter(f => f.path.startsWith("online/")).length;
        document.getElementById("online").textContent = onlineCount;
        document.getElementById("online2").textContent = onlineCount;

        renderTree(data.tree);
        updateTime();
      } catch (e) {
        document.getElementById("tree").innerHTML = "Lá»—i káº¿t ná»‘i GitHub API :( <br>Repo cÃ³ public khÃ´ng bro?";
        console.error(e);
      }
    }

    function renderTree(items) {
      const ul = document.createElement("ul");

      const folders = {};
      items.filter(item => item.type === "blob").forEach(item => {
        const parts = item.path.split('/');
        let current = ul;

        // Táº¡o folder
        for (let i = 0; i < parts.length - 1; i++) {
          const folderName = parts.slice(0, i + 1).join('/');
          if (!folders[folderName]) {
            const folderLi = document.createElement("li");
            folderLi.className = "folder";
            folderLi.textContent = parts[i] + "/";
            folderLi.onclick = (e) => {
              e.stopPropagation();
              toggleFolder(folderLi);
            };

            const subUl = document.createElement("ul");
            subUl.style.display = "none"; // collapsed máº·c Ä‘á»‹nh
            folderLi.appendChild(subUl);

            folders[folderName] = { li: folderLi, ul: subUl };

            if (i === 0) {
              ul.appendChild(folderLi);
            } else {
              // tÃ¬m parent folder
              const parentName = parts.slice(0, i).join('/');
              if (folders[parentName]) {
                folders[parentName].ul.appendChild(folderLi);
              }
            }
          }
          current = folders[folderName].ul;
        }

        // ThÃªm file
        const li = document.createElement("li");
        li.className = "file";
        li.textContent = parts[parts.length - 1];
        li.title = item.path;
        li.onclick = (e) => {
          e.stopPropagation();
          openFileInNewTab(item.path);
        };
        current.appendChild(li);
      });

      // File náº±m á»Ÿ root
      items.filter(item => item.type === "blob" && !item.path.includes('/')).forEach(item => {
        const li = document.createElement("li");
        li.className = "file";
        li.textContent = item.path;
        li.onclick = () => openFileInNewTab(item.path);
        ul.appendChild(li);
      });

      const container = document.getElementById("tree");
      container.innerHTML = "";
      container.appendChild(ul);
    }

    function openFileInNewTab(path) {
      let url;
      if (path.endsWith('.html')) {
        url = customDomain + path;
      } else {
        url = `https://raw.githubusercontent.com/${owner}/${repo}/main/${path}`;
      }
      window.open(url, '_blank');
    }

    function toggleFolder(li) {
      const ul = li.querySelector("ul");
      if (ul) ul.style.display = ul.style.display === "none" ? "block" : "none";
    }

    function updateTime() {
      document.getElementById("time").textContent = new Date().toLocaleString("vi-VN");
    }

    // Load láº§n Ä‘áº§u + auto refresh má»—i 2 phÃºt
    loadRepo();
    setInterval(loadRepo, 120000);

    // TÃ¬m kiáº¿m nhanh
    document.getElementById("search").addEventListener("input", (e) => {
      const term = e.target.value.toLowerCase();
      document.querySelectorAll(".file, .folder").forEach(el => {
        el.style.display = el.textContent.toLowerCase().includes(term) ? "" : "none";
      });
    });
  </script>
</body>
</html>
