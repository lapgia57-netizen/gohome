<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LCP - QuÃ¡n Net Chat Lan</title>
  <link rel="icon" href="https://raw.githubusercontent.com/lapgia57-netizen/LCP/main/favicon.ico" type="image/x-icon">
  <style>
    body { margin:0; font-family: system-ui; background:#0d1117; color:#c9d1d9; }
    .header { background:#010409; padding:20px; text-align:center; border-bottom:3px solid #f85149; }
    h1 { margin:0; color:#f85149; }
    .container { display:flex; height:calc(100vh - 100px); }
    .sidebar { width:35%; background:#161b22; border-right:1px solid #30363d; overflow:auto; }
    .content { width:65%; padding:20px; overflow:auto; }
    .tree ul { padding-left:20px; margin:5px 0; list-style:none; }
    .tree li { padding:6px; cursor:pointer; border-radius:6px; }
    .tree li:hover { background:#30363d; }
    .tree .folder::before { content:"ğŸ“ "; }
    .tree .file::before { content:"ğŸ“„ "; }
    .search { width:100%; padding:12px; background:#0d1117; border:1px solid #30363d; color:white; box-sizing:border-box; }
    #file-content { background:#0d1117; padding:20px; border-radius:8px; min-height:100%; }
    .online-count { position:fixed; bottom:10px; right:10px; background:#238636; color:white; padding:10px 15px; border-radius:50px; font-weight:bold; }
    .refresh { font-size:12px; color:#8b949e; text-align:center; margin-top:10px; }
    .instructions { background:#21262d; padding:15px; border-radius:8px; margin:10px 0; }
  </style>
</head>
<body>
  <div class="header">
    <h1>LCP â€“ Chá» táº¡i quÃ¡n net</h1>
    <p>Äang cÃ³ <span id="online">0</span> anh em trong quÃ¡n â€¢ Click file Ä‘á»ƒ má»Ÿ tab má»›i â€¢ Auto cáº­p nháº­t má»—i 2 phÃºt</p>
  </div>

  <div class="container">
    <div class="sidebar">
      <input type="text" class="search" id="search" placeholder="TÃ¬m file, nick, tin nháº¯n..."/>
      <div class="tree" id="tree">Äang load repo...</div>
    </div>
    <div class="content">
      <div id="file-content">
        <h2>ğŸ–¥ï¸ Báº£ng Ä‘iá»u khiá»ƒn Explorer</h2>
        <div class="instructions">
          <strong>Chá»©c nÄƒng má»›i:</strong><br>
          - <strong>File .html:</strong> Má»Ÿ tab má»›i táº¡i <code>https://lcp.lck.io.vn/[tÃªn-file]</code> (render trá»±c tiáº¿p trÃªn domain quÃ¡n net).<br>
          - <strong>File khÃ¡c:</strong> Má»Ÿ raw content táº¡i GitHub trong tab má»›i (xem nhanh Markdown/text).<br>
          <br>
          <strong>Máº¹o quÃ¡n net:</strong> Táº¡o file `online/nick-cua-ban.html` vá»›i ná»™i dung "Ä‘ang cÃ y rank" â†’ click nÃ³ sáº½ má»Ÿ trang cÃ¡ nhÃ¢n Ä‘áº¹p trÃªn domain!
        </div>
        <p><em>Chá»n file tá»« cÃ¢y bÃªn trÃ¡i Ä‘á»ƒ má»Ÿ tab má»›i nhÃ©!</em></p>
      </div>
    </div>
  </div>

  <div class="online-count">Online: <span id="online2">0</span></div>
  <div class="refresh">Cáº­p nháº­t láº§n cuá»‘i: <span id="time"></span></div>

  <script>
    const owner = "lapgia57-netizen";
    const repo = "LCP";
    const api = `https://api.github.com/repos/${owner}/${repo}/git/trees/main?recursive=1`;
    const customDomain = "https://lcp.lck.io.vn/";  // Domain Ä‘á»ƒ má»Ÿ file HTML

    async function loadRepo() {
      try {
        const res = await fetch(api);
        const data = await res.json();
        const files = data.tree.filter(f => f.type === "blob");
        const onlineCount = files.filter(f => f.path.startsWith("online/")).length;
        document.getElementById("online").textContent = onlineCount;
        document.getElementById("online2").textContent = onlineCount;

        renderTree(data.tree);
        updateTime();
      } catch (e) {
        document.getElementById("tree").innerHTML = "Lá»—i káº¿t ná»‘i GitHub API :(";
      }
    }

    function renderTree(items) {
      const ul = document.createElement("ul");
      // Hiá»ƒn thá»‹ folder náº¿u cÃ³ sub-file
      const folders = {};
      items.filter(item => item.type === "blob").forEach(item => {
        const parts = item.path.split('/');
        let current = ul;
        for (let i = 0; i < parts.length - 1; i++) {
          if (!folders[parts[i]]) {
            folders[parts[i]] = { li: null, ul: null };
          }
          if (!folders[parts[i]].li) {
            const folderLi = document.createElement("li");
            folderLi.className = "folder";
            folderLi.textContent = parts[i] + "/";
            folderLi.onclick = (e) => {
              e.stopPropagation();
              toggleFolder(folderLi);
            };
            const subUl = document.createElement("ul");
            subUl.className = "collapsed";
            folderLi.appendChild(subUl);
            folders[parts[i]].li = folderLi;
            folders[parts[i]].ul = subUl;
            // TÃ¬m parent vÃ  append
            // Simplified: Append all top-level to ul
            if (i === 0) {
              current.appendChild(folderLi);
            }
          }
          current = folders[parts[i]].ul;
        }
        // Add file to last ul
        const li = document.createElement("li");
        li.className = "file";
        li.textContent = parts[parts.length - 1];
        li.title = item.path;  // Full path for tooltip
        li.onclick = (e) => {
          e.stopPropagation();
          openFileInNewTab(item.path);
        };
        current.appendChild(li);
      });

      // Add root files (no folder)
      items.filter(item => item.type === "blob" && !item.path.includes('/')).forEach(item => {
        const li = document.createElement("li");
        li.className = "file";
        li.textContent = item.path;
        li.onclick = () => openFileInNewTab(item.path);
        ul.appendChild(li);
      });

      const container = document.getElementById("tree");
      container.innerHTML = "";
      container.appendChild(ul);
    }

    // Chá»©c nÄƒng má»Ÿ tab má»›i theo loáº¡i file
    function openFileInNewTab(path) {
      let url;
      if (path.endsWith('.html')) {
        // Má»Ÿ trÃªn custom domain
        url = customDomain + path;
      } else {
        // Má»Ÿ raw tá»« GitHub
        url = `https://raw.githubusercontent.com/${owner}/${repo}/main/${path}`;
      }
      window.open(url, '_blank');
    }

    // Toggle folder (náº¿u cáº§n expand sub)
    function toggleFolder(li) {
      const subUl = li.querySelector('ul');
      if (subUl) {
        subUl.classList.toggle('collapsed');
      }
    }

    function updateTime() {
      document.getElementById("time").textContent = new Date().toLocaleString("vi-VN");
    }

    // Tá»± Ä‘á»™ng refresh má»—i 2 phÃºt
    loadRepo();
    setInterval(loadRepo, 120000);

    // TÃ¬m kiáº¿m realtime
    document.getElementById("search").addEventListener("input", (e) => {
      const term = e.target.value.toLowerCase();
      document.querySelectorAll(".file, .folder").forEach(li => {
        const text = li.textContent.toLowerCase();
        li.style.display = text.includes(term) ? "" : "none";
      });
    });
  </script>
</body>
</html>
