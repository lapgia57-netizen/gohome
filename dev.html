<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>GO HOME - Net Explorer</title>
<link rel="icon" href="https://raw.githubusercontent.com/lapgia57-netizen/gohome/main/favicon.ico">
<style>
:root{
  --bg:#0d1117;
  --panel:#161b22;
  --border:#30363d;
  --red:#f85149;
  --green:#238636;
  --blue:#58a6ff;
  --text:#c9d1d9;
  --muted:#8b949e;
}
*{box-sizing:border-box;margin:0;padding:0;}
body{
  font-family:system-ui,sans-serif;
  background:var(--bg);
  color:var(--text);
  min-height:100vh;
}

/* LOADING */
#loading{
  position:fixed;
  inset:0;
  background:rgba(13,17,23,0.98);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  z-index:9999;
  transition:opacity 0.4s;
}
.loader{
  width:60px;height:60px;
  border:5px solid var(--border);
  border-top:5px solid var(--red);
  border-radius:50%;
  animation:spin 1s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}
#loading p{margin-top:20px;color:var(--muted);font-size:15px;}

/* HEADER */
.header{
  background:#010409;
  padding:16px 20px;
  text-align:center;
  border-bottom:3px solid var(--red);
}
.header h1{
  margin:0;
  color:var(--red);
  font-size:2.1rem;
}
.header small{color:var(--muted);}

/* MAIN LAYOUT */
main{
  display:flex;
  height:calc(100vh - 110px);
}
.sidebar{
  width:320px;
  background:var(--panel);
  border-right:1px solid var(--border);
  overflow:auto;
  padding:12px;
}
.content{
  flex:1;
  padding:20px;
  overflow:auto;
}

/* SEARCH & TREE */
.search{
  width:100%;
  padding:10px 12px;
  margin-bottom:12px;
  background:var(--bg);
  border:1px solid var(--border);
  color:var(--text);
  border-radius:6px;
}
.tree ul{list-style:none;padding-left:16px;}
.tree li{
  padding:6px 8px;
  border-radius:6px;
  cursor:pointer;
  transition:0.15s;
}
.tree li:hover{background:#21262d;}
.folder::before{content:"üìÅ ";}
.file::before{content:"üìÑ ";}

/* FILE CARDS - NEW UI */
#html-files{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(280px,1fr));
  gap:16px;
  margin-top:20px;
}
.card{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:10px;
  padding:16px;
  cursor:pointer;
  transition:all 0.2s;
  position:relative;
  overflow:hidden;
}
.card:hover{
  transform:translateY(-4px);
  border-color:var(--blue);
  box-shadow:0 8px 24px rgba(0,0,0,0.4);
}
.card h3{
  margin:0 0 8px;
  font-size:1.1rem;
  color:var(--blue);
}
.card .path{
  font-size:0.85rem;
  color:var(--muted);
  word-break:break-all;
}
.card .title{
  margin-top:10px;
  font-size:0.95rem;
  color:var(--text);
  font-style:italic;
}
.card .loading-title{font-style:normal;color:var(--muted);}

/* STATUS BAR */
.status-bar{
  position:fixed;
  bottom:16px;
  left:16px;
  right:16px;
  display:flex;
  justify-content:space-between;
  font-size:13px;
  color:var(--muted);
  pointer-events:none;
}
.online-count{
  background:var(--green);
  color:white;
  padding:8px 14px;
  border-radius:999px;
  font-weight:bold;
}
.clock,.refresh{
  background:#21262d;
  padding:8px 14px;
  border-radius:999px;
  border:1px solid var(--border);
}

@media (max-width:900px){
  main{flex-direction:column;height:auto;}
  .sidebar{width:100%;height:40vh;border-right:none;border-bottom:1px solid var(--border);}
  .content{padding:16px;}
}
</style>
</head>
<body>

<div id="loading">
  <div class="loader"></div>
  <p>GO HOME ƒëang qu√©t qu√°n net... ch·ªù t√≠ nh√© anh em</p>
</div>

<div class="header">
  <h1>GO HOME</h1>
  <small>Online <span id="online">0</span> anh em ‚Ä¢ Auto refresh 2 ph√∫t</small>
</div>

<main>
  <div class="sidebar">
    <input class="search" id="search" placeholder="T√¨m file, nick, t√™n profile...">
    <div class="tree" id="tree">ƒêang load danh s√°ch file...</div>
  </div>

  <div class="content">
    <h2>üñ•Ô∏è C√°c profile HTML ƒëang online</h2>
    <p id="html-count" style="color:var(--muted);margin:8px 0;">ƒêang t·∫£i danh s√°ch...</p>
    <div id="html-files"></div>

    <div id="file-content" style="display:none;margin-top:32px;">
      <h3>Ch·ªçn file b√™n tr√°i ho·∫∑c card b√™n tr√™n ƒë·ªÉ m·ªü</h3>
    </div>
  </div>
</main>

<div class="status-bar">
  <div class="online-count">Online: <span id="online2">0</span></div>
  <div class="clock" id="clock">‚è∞ --:--:--</div>
  <div class="refresh">C·∫≠p nh·∫≠t: <span id="time"></span></div>
</div>

<script>
const owner = "lapgia57-netizen";
const repo = "gohome";
const api = `https://api.github.com/repos/${owner}/${repo}/git/trees/main?recursive=1`;
const customDomain = "https://back.iq920.fun/";

const treeEl = document.getElementById("tree");
const htmlFilesEl = document.getElementById("html-files");
const htmlCountEl = document.getElementById("html-count");
const onlineEl = document.getElementById("online");
const online2El = document.getElementById("online2");
const timeEl = document.getElementById("time");
const clockEl = document.getElementById("clock");
const loading = document.getElementById("loading");
const search = document.getElementById("search");

async function loadRepo() {
  loading.style.display = "flex";
  try {
    const res = await fetch(api);
    if (!res.ok) throw new Error("GitHub API error");
    const data = await res.json();

    const allFiles = data.tree.filter(f => f.type === "blob");
    const htmlFiles = allFiles.filter(f => 
      f.path.endsWith(".html") && 
      !f.path.includes("CNAME") && 
      !f.path.includes("LICENSE") && 
      !f.path.startsWith(".github/")
    );

    const online = allFiles.filter(f => f.path.startsWith("online/")).length;

    onlineEl.textContent = online;
    online2El.textContent = online;
    htmlCountEl.innerHTML = `T√¨m th·∫•y <b>${htmlFiles.length}</b> file HTML ‚Ä¢ T·ªïng ${allFiles.length} file`;

    renderTree(data.tree);
    renderHtmlCards(htmlFiles);

    updateTime();
  } catch (e) {
    treeEl.innerHTML = "‚ùå L·ªói k·∫øt n·ªëi GitHub API";
    htmlCountEl.textContent = "Kh√¥ng t·∫£i ƒë∆∞·ª£c danh s√°ch";
  }
  setTimeout(() => loading.style.display = "none", 400);
}

function renderTree(items) {
  const ul = document.createElement("ul");
  const folders = {};

  items.filter(i => i.type === "blob").forEach(item => {
    // ·∫®n file kh√¥ng mu·ªën hi·ªÉn th·ªã
    if (item.path.includes("CNAME") || item.path.includes("LICENSE") || item.path.startsWith(".github/")) return;

    const parts = item.path.split('/');
    let current = ul;

    for (let i = 0; i < parts.length - 1; i++) {
      const name = parts.slice(0, i + 1).join('/');
      if (!folders[name]) {
        const li = document.createElement("li");
        li.className = "folder";
        li.textContent = parts[i] + "/";
        const sub = document.createElement("ul");
        sub.style.display = "none";
        li.onclick = e => {
          e.stopPropagation();
          sub.style.display = sub.style.display === "none" ? "block" : "none";
        };
        li.appendChild(sub);
        folders[name] = { ul: sub };
        (i === 0 ? ul : folders[parts.slice(0, i).join('/')].ul).appendChild(li);
      }
      current = folders[name].ul;
    }

    const file = document.createElement("li");
    file.className = "file";
    file.textContent = parts.at(-1);
    file.onclick = e => {
      e.stopPropagation();
      openFile(item.path);
    };
    current.appendChild(file);
  });

  treeEl.innerHTML = "";
  treeEl.appendChild(ul);
}

async function renderHtmlCards(htmlFiles) {
  htmlFilesEl.innerHTML = "";
  for (const file of htmlFiles) {
    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <h3>${file.path.split('/').pop()}</h3>
      <div class="path">${file.path}</div>
      <div class="title loading-title">ƒêang l·∫•y title...</div>
    `;
    card.onclick = () => openFile(file.path);
    htmlFilesEl.appendChild(card);

    // L·∫•y title t·ª´ raw HTML
    try {
      const rawUrl = `https://raw.githubusercontent.com/${owner}/${repo}/main/${file.path}`;
      const res = await fetch(rawUrl);
      const text = await res.text();
      const match = text.match(/<title[^>]*>(.*?)<\/title>/is);
      const title = match ? match[1].trim() : "Kh√¥ng c√≥ title";
      card.querySelector(".title").textContent = title;
      card.querySelector(".title").classList.remove("loading-title");
    } catch {
      card.querySelector(".title").textContent = "(kh√¥ng l·∫•y ƒë∆∞·ª£c title)";
    }
  }
}

function openFile(path) {
  const url = path.endsWith(".html")
    ? customDomain + path
    : `https://raw.githubusercontent.com/${owner}/${repo}/main/${path}`;
  window.open(url, "_blank");
}

function updateTime() {
  timeEl.textContent = new Date().toLocaleString("vi-VN");
}

// Clock realtime VN
setInterval(() => {
  clockEl.textContent = "‚è∞ " + new Date().toLocaleTimeString("vi-VN", {hour12: false});
}, 1000);

// Search filter (√°p d·ª•ng cho c·∫£ tree v√† cards)
search.oninput = e => {
  const t = e.target.value.toLowerCase();
  document.querySelectorAll(".file,.folder,.card").forEach(el => {
    el.style.display = el.textContent.toLowerCase().includes(t) ? "" : "none";
  });
};

loadRepo();
setInterval(loadRepo, 120000);
</script>
</body>
</html>
